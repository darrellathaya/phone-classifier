name: Deploy to Supabase

on:
  workflow_run:
    workflows: ["Retrain Model on New Data"]  # Match the 'name' in ci.yml
    types:
      - completed

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Login to Supabase
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
        run: |
          echo "$SUPABASE_ACCESS_TOKEN" | supabase login --token-from-stdin

      - name: Deploy Supabase project
        run: supabase db push