name: Build and deploy Dockerized FastAPI to Azure Web App - phone-classifier

on:
  workflow_run:
    workflows: ["Retrain Model on New Data"]
    types:
      - completed

env:
  AZURE_WEBAPP_NAME: phone-classifier
  AZURE_WEBAPP_PACKAGE_PATH: ./webapp
  DOCKERFILE_PATH: ./webapp/Dockerfile

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Azure Web App via Dockerfile
        uses: azure/webapps-deploy@v3
        with:
          app-name: ${{ env.AZURE_WEBAPP_NAME }}
          publish-profile: ${{ secrets.AZUREAPPSERVICE_PUBLISHPROFILE_AD68A6E93B1D49429B4B0890399445D7 }}
          package: ${{ env.AZURE_WEBAPP_PACKAGE_PATH }}
          dockerfile: ${{ env.DOCKERFILE_PATH }}